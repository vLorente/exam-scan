<form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
  <!-- Nombre Completo -->
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Nombre Completo</mat-label>
    <input
      matInput
      formControlName="full_name"
      placeholder="Tu nombre completo"
      autocomplete="name"
    >
    <mat-icon matSuffix>person</mat-icon>
    @if (registerForm.get('full_name')?.invalid && registerForm.get('full_name')?.touched) {
      <mat-error>El nombre es requerido</mat-error>
    }
  </mat-form-field>

  <!-- Nombre de Usuario -->
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Nombre de Usuario</mat-label>
    <input
      matInput
      formControlName="username"
      placeholder="Usuario único"
      autocomplete="username"
    >
    <mat-icon matSuffix>account_circle</mat-icon>
    @if (registerForm.get('username')?.invalid && registerForm.get('username')?.touched) {
      <mat-error>El nombre de usuario es requerido</mat-error>
    }
  </mat-form-field>

  <!-- Email -->
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Correo Electrónico</mat-label>
    <input
      matInput
      type="email"
      formControlName="email"
      placeholder="tu@email.com"
      autocomplete="email"
    >
    <mat-icon matSuffix>email</mat-icon>
    @if (registerForm.get('email')?.invalid && registerForm.get('email')?.touched) {
      <mat-error>
        @if (registerForm.get('email')?.errors?.['required']) {
          El email es requerido
        }
        @if (registerForm.get('email')?.errors?.['email']) {
          Ingresa un email válido
        }
      </mat-error>
    }
  </mat-form-field>

  <!-- Tipo de Usuario -->
  <mat-form-field appearance="fill" class="full-width">
    <mat-label>Tipo de Usuario</mat-label>
    <mat-select formControlName="role">
      <mat-option value="teacher">
        <mat-icon>school</mat-icon>
        Profesor
      </mat-option>
      <mat-option value="student">
        <mat-icon>menu_book</mat-icon>
        Estudiante
      </mat-option>
    </mat-select>
    <mat-icon matSuffix>badge</mat-icon>
    @if (registerForm.get('role')?.invalid && registerForm.get('role')?.touched) {
      <mat-error>Selecciona tu tipo de usuario</mat-error>
    }
  </mat-form-field>

  <!-- Contraseña -->
  <mat-form-field appearance="fill" class="full-width password-field">
    <mat-label>Contraseña</mat-label>
    <input
      matInput
      [type]="showPassword() ? 'text' : 'password'"
      formControlName="password"
      placeholder="Mínimo 6 caracteres"
      autocomplete="new-password"
    >
    <button
      mat-icon-button
      matSuffix
      type="button"
      (click)="togglePasswordVisibility()"
      [attr.aria-label]="'Mostrar contraseña'"
      [attr.aria-pressed]="showPassword()"
      class="password-toggle"
    >
      <mat-icon>{{showPassword() ? 'visibility' : 'visibility_off'}}</mat-icon>
    </button>
    @if (registerForm.get('password')?.invalid && registerForm.get('password')?.touched) {
      <mat-error>
        @if (registerForm.get('password')?.errors?.['required']) {
          La contraseña es requerida
        }
        @if (registerForm.get('password')?.errors?.['minlength']) {
          La contraseña debe tener al menos 6 caracteres
        }
      </mat-error>
    }
  </mat-form-field>

  <!-- Confirmar Contraseña -->
  <mat-form-field appearance="fill" class="full-width password-field">
    <mat-label>Confirmar Contraseña</mat-label>
    <input
      matInput
      [type]="showConfirmPassword() ? 'text' : 'password'"
      formControlName="confirmPassword"
      placeholder="Repite tu contraseña"
      autocomplete="new-password"
    >
    <button
      mat-icon-button
      matSuffix
      type="button"
      (click)="toggleConfirmPasswordVisibility()"
      [attr.aria-label]="'Mostrar contraseña'"
      [attr.aria-pressed]="showConfirmPassword()"
      class="password-toggle"
    >
      <mat-icon>{{showConfirmPassword() ? 'visibility' : 'visibility_off'}}</mat-icon>
    </button>
    @if (registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched) {
      <mat-error>
        @if (registerForm.get('confirmPassword')?.errors?.['required']) {
          Confirma tu contraseña
        }
      </mat-error>
    }
    @if (registerForm.hasError('passwordMismatch') && registerForm.get('confirmPassword')?.touched) {
      <mat-error>Las contraseñas no coinciden</mat-error>
    }
  </mat-form-field>

  <!-- Botón de Registro -->
  <button
    mat-raised-button
    color="primary"
    type="submit"
    class="submit-button full-width"
    [disabled]="registerForm.invalid || loading()"
  >
    @if (loading()) {
      <mat-spinner diameter="20" class="inline-spinner"></mat-spinner>
      Creando cuenta...
    } @else {
      <ng-container>
        <mat-icon>person_add</mat-icon>
        Crear Cuenta
      </ng-container>
    }
  </button>
</form>
