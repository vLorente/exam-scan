<app-layout
  title="ExamScan"
  subtitle="Mis Exámenes"
>
  <section class="exams-page" animate.enter="animate-fade-in-up">
    <!-- Create Exam CTA Section -->
    <app-create-exam-cta animate.enter="animate-fade-in-up"></app-create-exam-cta>

    <header class="page-header">
      <div class="header-content">
        <div class="header-text">
          <h1 class="page-title">
            Mis Exámenes
          </h1>
          <p class="page-subtitle">
            Accede a tus exámenes asignados y comienza a evaluarte
          </p>
        </div>

        <!-- View Toggle -->
        @if (!loading() && !error() && exams().length > 0) {
          <div class="view-toggle desktop-only">
            <button
              class="toggle-button"
              (click)="onToggleViewMode()"
              [attr.aria-label]="getViewModeLabel()"
              [attr.aria-pressed]="viewMode() === 'list'"
              type="button">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                <path [attr.d]="getViewModeIcon()"/>
              </svg>
              <span class="toggle-text">{{ getViewModeLabel() }}</span>
            </button>
          </div>
        }
      </div>
    </header>

    <!-- Loading State -->
    @if (loading()) {
      <div class="loading-container" role="status" aria-label="Cargando exámenes">
        <div class="loading-spinner" aria-hidden="true"></div>
        <p class="loading-text">Cargando exámenes...</p>
      </div>
    }

    <!-- Error State -->
    @if (error() && !loading()) {
      <div class="error-container" role="alert">
        <div class="error-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <circle cx="12" cy="12" r="10"/>
            <line x1="15" y1="9" x2="9" y2="15"/>
            <line x1="9" y1="9" x2="15" y2="15"/>
          </svg>
        </div>
        <h2 class="error-title">Error al cargar exámenes</h2>
        <p class="error-message">{{ error() }}</p>
        <button
          class="btn btn-primary"
          (click)="onRetry()"
          aria-describedby="retry-desc">
          Reintentar
        </button>
        <span id="retry-desc" class="sr-only">Volver a cargar la lista de exámenes</span>
      </div>
    }

    <!-- Empty State -->
    @if (!loading() && !error() && exams().length === 0) {
      <div class="empty-container">
        <div class="empty-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M9 12l2 2 4-4"/>
            <circle cx="12" cy="12" r="10"/>
          </svg>
        </div>
        <h2 class="empty-title">No hay exámenes disponibles</h2>
        <p class="empty-message">
          Actualmente no tienes exámenes asignados. Consulta con tu instructor para más información.
        </p>
      </div>
    }

    <!-- Exams Grid or List -->
    @if (!loading() && !error() && exams().length > 0) {
      <!-- Desktop: Show selected view mode -->
      <div class="desktop-view">
        @if (viewMode() === 'grid') {
          <div class="exams-grid" animate.enter="animate-fade-in-up" style="animation-delay: 0.2s;">
            @for (exam of exams(); track exam.id) {
              <app-exam-card
                [exam]="exam"
                [showActions]="true"
                (examClick)="onExamClick($event)"
                animate.enter="animate-fade-in-up"
                [style.animation-delay]="($index * 0.1) + 's'">
              </app-exam-card>
            }
          </div>
        } @else {
          <div class="exams-list" animate.enter="animate-fade-in-up" style="animation-delay: 0.2s;">
            @for (exam of exams(); track exam.id) {
              <app-exam-list-item
                [exam]="exam"
                [showActions]="true"
                (examClick)="onExamClick($event)"
                animate.enter="animate-fade-in-left"
                [style.animation-delay]="($index * 0.05) + 's'">
              </app-exam-list-item>
            }
          </div>
        }
      </div>

      <!-- Mobile: Always show grid view -->
      <div class="mobile-view">
        <div class="exams-grid" animate.enter="animate-fade-in-up" style="animation-delay: 0.2s;">
          @for (exam of exams(); track exam.id) {
            <app-exam-card
              [exam]="exam"
              [showActions]="true"
              (examClick)="onExamClick($event)"
              animate.enter="animate-fade-in-up"
              [style.animation-delay]="($index * 0.1) + 's'">
            </app-exam-card>
          }
        </div>
      </div>

      <!-- Summary Stats -->
      <section class="exams-summary" aria-label="Resumen de exámenes">
        <div class="summary-card">
          <h2 class="summary-title">Resumen</h2>
          <div class="summary-stats">
            <div class="stat-item">
              <span class="stat-value">{{ exams().length }}</span>
              <span class="stat-label">Exámenes Totales</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">{{ activeExamsCount() }}</span>
              <span class="stat-label">Disponibles</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">{{ totalQuestions() }}</span>
              <span class="stat-label">Preguntas Totales</span>
            </div>
          </div>
        </div>
      </section>
    }
  </section>
</app-layout>
